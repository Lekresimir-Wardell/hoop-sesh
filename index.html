<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Lekre≈°imir Wardell Hoops - Login & Reservations</title>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <style>
    /* Centering & Warriors 2009 colors */
    body { font-family: Arial,sans-serif; text-align:center; background:#FFC72C; color:#1D428A; margin:0; padding:0; display:flex; flex-direction:column; align-items:center; min-height:100vh; justify-content:center; }
    #loginForm, #calendarContainer { background:#FFC72C; color:#1D428A; padding:30px; border-radius:12px; box-shadow:0 4px 15px rgba(0,0,0,0.3); max-width:450px; width:90%; }
    input, textarea { width:80%; padding:10px; margin:10px auto; display:block; border-radius:6px; border:1px solid #1D428A; font-size:16px; }
    button { background:#1D428A; color:#FFC72C; border:none; padding:10px 20px; margin:5px; border-radius:6px; font-weight:bold; cursor:pointer; }
    button:hover { background:#10275c; }
    #calendar { display:flex; flex-wrap:wrap; justify-content:center; margin:20px auto; max-width:420px; }
    .day { width:60px; height:60px; line-height:60px; margin:2px; font-weight:bold; border-radius:6px; cursor:pointer; border:1px solid #1D428A; }
    .available { background:#a0f9a0; }
    .reserved { background:#f99; cursor:not-allowed; }
    .mine { background:#99c0ff; cursor:default; }
    #reservationForm { display:none; margin-top:20px; }
    textarea { width:90%; margin:5px; }
    .legend { margin-top:20px; font-weight:bold; }
    .legend span { display:inline-block; width:20px; height:20px; margin-right:5px; vertical-align:middle; border-radius:4px; }
  </style>
</head>
<body>

<!-- LOGIN FORM -->
<div id="loginForm">
  <h1>Prijava</h1>
  <input type="email" id="email" placeholder="Email" required>
  <input type="password" id="password" placeholder="Lozinka" required>
  <button id="loginBtn">Prijavi se</button>
  <button id="registerBtn">Registriraj se</button>
  <p id="loginError" style="color:red;"></p>
</div>

<!-- CALENDAR & RESERVATION -->
<div id="calendarContainer" style="display:none;">
  <h1>Rezerviraj Hoop Sesh</h1>
  <button id="logoutBtn">Odjava</button>
  <div>
    <button id="prevMonth">‚Üê</button>
    <span id="monthYear"></span>
    <button id="nextMonth">‚Üí</button>
  </div>
  <div id="calendar"></div>

  <form id="reservationForm">
    <h2>Rezervacija za <span id="selectedDate"></span></h2>
    <label>Vrijeme: <input type="text" name="time" placeholder="npr. 18:00" required></label><br>
    <label>Imena i prezimena (odvojena zarezom):</label><br>
    <textarea name="names" placeholder="Ime1 Prezime1, Ime2 Prezime2" required></textarea><br>
    <button type="submit">Rezerviraj</button>
    <button type="button" id="cancelBtn">Odustani</button>
  </form>

  <div class="legend">
    <div><span class="available"></span> Slobodno</div>
    <div><span class="reserved"></span> Zauzeto</div>
    <div><span class="mine"></span> Tvoj termin</div>
  </div>
</div>

<script>
  // üîë Firebase Config (put your own Firebase project keys here)
 const firebaseConfig = {
  apiKey: "AIzaSyAnFYrebR69a2rmYeT-TWrX1RB_Tzsh3Tk",
  authDomain: "hoops-165ec.firebaseapp.com",
  projectId: "hoops-165ec",
  storageBucket: "hoops-165ec.firebasestorage.app",
  messagingSenderId: "563400604791",
  appId: "1:563400604791:web:50183bcf65de09bd019a72",
  measurementId: "G-C3YPHXZCXN"
};

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  const loginForm = document.getElementById("loginForm");
  const calendarContainer = document.getElementById("calendarContainer");
  const loginError = document.getElementById("loginError");
  const emailInput = document.getElementById("email");
  const passwordInput = document.getElementById("password");

  const calendarEl = document.getElementById("calendar");
  const monthYearEl = document.getElementById("monthYear");
  const form = document.getElementById("reservationForm");
  const selectedDateEl = document.getElementById("selectedDate");
  const cancelBtn = document.getElementById("cancelBtn");

  let selectedDate = null;
  let currentMonth = new Date().getMonth();
  let currentYear = new Date().getFullYear();
  let reservedDates = new Set();
  let userEmail = null;

  // LOGIN
  document.getElementById("loginBtn").addEventListener("click", () => {
    auth.signInWithEmailAndPassword(emailInput.value, passwordInput.value)
      .catch(err => loginError.textContent = err.message);
  });

  document.getElementById("registerBtn").addEventListener("click", () => {
    auth.createUserWithEmailAndPassword(emailInput.value, passwordInput.value)
      .catch(err => loginError.textContent = err.message);
  });

  document.getElementById("logoutBtn").addEventListener("click", () => {
    auth.signOut();
  });

  auth.onAuthStateChanged(user => {
    if(user){
      userEmail = user.email;
      loginForm.style.display = "none";
      calendarContainer.style.display = "block";
      renderCalendar(currentMonth, currentYear);
    } else {
      loginForm.style.display = "block";
      calendarContainer.style.display = "none";
    }
  });

  // CALENDAR
  function renderCalendar(month, year){
    calendarEl.innerHTML = "";
    reservedDates.clear();
    const daysInMonth = new Date(year, month+1, 0).getDate();
    monthYearEl.textContent = `${year}-${month+1}`;

    db.collection("reservations").where("status","!=","rejected").get().then(snapshot => {
      snapshot.forEach(doc => {
        const data = doc.data();
        reservedDates.add(JSON.stringify({date: data.date, email: data.userEmail || ""}));
      });

      for(let d=1; d<=daysInMonth; d++){
        const dayEl = document.createElement("div");
        dayEl.className = "day";
        const dateStr = `${year}-${month+1}-${d}`;
        dayEl.dataset.date = dateStr;
        dayEl.textContent = d;

        const today = new Date();
        if(new Date(year, month, d) < new Date(today.getFullYear(), today.getMonth(), today.getDate())){
          dayEl.classList.add("reserved"); // pro≈°li dani
        } else {
          let found = false;
          reservedDates.forEach(r=>{
            const obj = JSON.parse(r);
            if(obj.date===dateStr){
              if(obj.email === userEmail){
                dayEl.classList.add("mine"); // tvoj termin
              } else {
                dayEl.classList.add("reserved");
              }
              found = true;
            }
          });
          if(!found){
            dayEl.classList.add("available");
            dayEl.addEventListener("click",()=>selectDate(dateStr));
          }
        }
        calendarEl.appendChild(dayEl);
      }
    });
  }

  function selectDate(date){
    selectedDate = date;
    selectedDateEl.textContent = date;
    form.style.display = "block";
  }

  cancelBtn.addEventListener("click", ()=>{
    form.reset();
    form.style.display = "none";
  });

  document.getElementById("prevMonth").addEventListener("click", ()=>{
    currentMonth--;
    if(currentMonth<0){currentMonth=11;currentYear--;}
    renderCalendar(currentMonth,currentYear);
  });

  document.getElementById("nextMonth").addEventListener("click", ()=>{
    currentMonth++;
    if(currentMonth>11){currentMonth=0;currentYear++;}
    renderCalendar(currentMonth,currentYear);
  });

  form.addEventListener("submit", async e=>{
    e.preventDefault();
    const time = form.time.value;
    const names = form.names.value;

    const exists = await db.collection("reservations").where("date","==",selectedDate).where("time","==",time).get();

    if(!exists.empty){
      alert("Termin veƒá rezerviran!");
      return;
    }

    await db.collection("reservations").add({
      date: selectedDate,
      time,
      names,
      status: "pending",
      userEmail,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });

    alert("Termin rezerviran! ƒåeka odobrenje.");
    form.reset();
    form.style.display = "none";
    renderCalendar(currentMonth,currentYear);
  });
</script>
</body>
</html>
